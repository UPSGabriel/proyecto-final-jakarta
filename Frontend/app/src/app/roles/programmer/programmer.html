<div class="programmer-layout">
  <aside class="sidebar">
    <ng-container *ngIf="data$ | async as data">
      <div class="profile">
        <h3>{{ data.user.displayName }}</h3>
        <p class="role-badge">Programador</p>
      </div>
      <nav>
        <button [class.active]="currentView === 'projects'" 
                (click)="setView('projects')">
          üìÅ Mis Proyectos
        </button>
        
        <button [class.active]="currentView === 'appointments'" 
                (click)="setView('appointments')">
          üìÖ Asesor√≠as 
          <span class="count" *ngIf="data.appointments.length">{{ data.appointments.length }}</span>
        </button>
        
        <button (click)="auth.logout()" class="logout">Cerrar Sesi√≥n</button>
      </nav>
    </ng-container>
  </aside>

  <main class="content">
    <ng-container *ngIf="data$ | async as data; else loading">
      
      <div *ngIf="currentView === 'projects'" class="fade-in">
        <header><h2>Gesti√≥n de Portafolio</h2></header>
        
        <div class="add-project-card">
          <h3>Nuevo Proyecto</h3>
          <div class="form-grid">
            <input type="text" [(ngModel)]="newProject.title" placeholder="T√≠tulo">
            <input type="text" [(ngModel)]="newProject.tech" placeholder="Tecnolog√≠as">
            <input type="text" [(ngModel)]="newProject.link" placeholder="Link Repo/Demo">
            <textarea [(ngModel)]="newProject.description" placeholder="Descripci√≥n"></textarea>
            <button (click)="addProject(data.user.uid)">+ Guardar</button> 
          </div>
        </div>

        <div class="projects-list">
          <div class="project-item" *ngFor="let proj of data.projects">
            <div>
              <h4>{{ proj.title }}</h4>
              <p>{{ proj.description }}</p>
              <small class="tech">{{ proj.tech }}</small>
            </div>
            <button (click)="deleteProject(data.user.uid, proj.id!)" class="delete-btn">√ó</button>
          </div>
        </div>
      </div>

      <div *ngIf="currentView === 'appointments'" class="fade-in">
        <header>
          <h2>Solicitudes de Asesor√≠a</h2>
          <button class="test-btn" (click)="createDemo(data.user.uid)">+ Crear Solicitud de Prueba</button>
        </header>

        <div class="appointments-grid">
          <div class="card-apt" *ngFor="let apt of data.appointments" [class]="apt.status">
            <div class="apt-header">
              <span class="status-badge">{{ apt.status | uppercase }}</span>
              <span class="date">{{ apt.date.seconds * 1000 | date:'short' }}</span>
            </div>
            
            <h4>{{ apt.userName }}</h4>
            <p class="contact">{{ apt.userContact }}</p>
            <p class="topic">"{{ apt.topic }}"</p>

            <div class="actions" *ngIf="apt.status === 'pending'">
              <button class="approve" (click)="respondAppointment(apt.id!, 'approved')">Aprobar</button>
              <button class="reject" (click)="respondAppointment(apt.id!, 'rejected')">Rechazar</button>
            </div>
            <div class="actions" *ngIf="apt.status !== 'pending'">
              <p>Solicitud gestionada.</p>
            </div>
          </div>

          <p *ngIf="data.appointments.length === 0">No tienes solicitudes pendientes.</p>
        </div>
      </div>

    </ng-container>
    <ng-template #loading><p class="loading">Cargando panel...</p></ng-template>
  </main>
</div>